<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
   <HEAD>
      <TITLE>LSLC Notebooks</TITLE>
       <meta charset="UTF-8">

 
       <!--Google font-->
            <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600" rel="stylesheet">

       <!-- Async -->
            <script src="https://unpkg.com/async@2.4.0/dist/async.min.js"></script>
       <!-- docs  caolan.github.io/async/docs.html -->

       <!-- Load Leaflet from CDN-->
           <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
           <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet-src.js"></script>
       
       <!-- Load Esri Leaflet from CDN -->
            <script src="https://unpkg.com/esri-leaflet@2.0.7"></script>
 
       <!-- JQuery  -->
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
       
       <!-- JQuery UI  -->
            <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.0/themes/smoothness/jquery-ui.css">
            <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.0/jquery-ui.min.js"></script>
    
       
       <!-- local stylesheets -->
           <LINK href="generalStyle.css" rel='stylesheet'/>
           <LINK href="recordStyle.css" rel='stylesheet'/> 
           <LINK href="modalStyle.css" rel='stylesheet'/>

           <style>
           #menus{
           	height: 30px;
           	width: 20%;
           	background-color: #e6e6e6;
           	text-align: center;

           }
           #menus:hover{
			    cursor: pointer;
			    background-color: dimgrey;
			}

			.menuItem{
				height: 30px;
				width: 100%;
				position: relative;
				top: 20px;
				background-color: #fff;
				text-align: center;
			}

			.menuItem:hover{
				background-color: #e6e6e6;
			}
           


           </style>

       
      <!-- Enable media queries for old IE -->
      <!--[if lt IE 9]>
        <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
      <![endif]-->
       
</HEAD>
<BODY>
  
   
   <div id="wrapper">
        
       <div id="header"></div>
       <div id="menus">Sort By</div>
       
       	<h2>Notebooks</h2> 
       <span>This is a list of all field notebooks in the Lake Superior Legacy Collection. Most of these notebooks are available as digital scans on the UW Digital Collections website. Some were not prioritized for scanning, and some no longer exist.</span>
       
       <!-- <div class='reportDivision'><div id="fieldNotebooksList"></div></div> -->
       <div class='divisioncontent' id='notebooksContent'></div>
   
       
       <div id="footer"></div>
   </div><!--end wrapper div-->
   
   <!-- header js and css to highlight the corresponding nav button: must go after the wrapper div and header div -->
   <script src="header.js"></script>
   <script>
           //indicate the current page in the nav bar. 
          // $("#navHome").css("background-color", "#848484");
   </script>
    
    <!-- javascript links -->
    <script src="mapServiceUrls.js"></script>
    
    <!-- javascript for building the notebook list -->
    <script>
    var globalNotebookContentArray = [];
    var menuOn = false;
    var sortMethod = "Number";
    var sortOrder = "ascending";


    $("#menus").click(function(){
    	if (!menuOn){
    		menuOn = true;
    		$(this).append($("<div id='menu_year' class='menuItem'>Year</div><div id='menu_number' class='menuItem'>Notebook Number</div><div id='menu_author' class='menuItem'>Author</div>"));

	    		$("#menu_year").click(function(){
			    	console.log("ran")
			    	sortMethod = "Year";
			    	async.series([callSort, buildNotebooksList, replaceImages]);
			    })

			    $("#menu_number").click(function(){
			    	sortMethod = "Number";
			    	async.series([callSort, buildNotebooksList, replaceImages]);
			    })

			    $("#menu_author").click(function(){
			    	sortMethod = "Author";
			    	async.series([callSort, buildNotebooksList, replaceImages]);
			    })

    	} else {
    		menuOn = false;
    		$(".menuItem").remove();
    	};
    });
 
        
    function retrieveNotebooks(indicator){
    	var notebooksQuery = L.esri.query({url: notebooksTableURL});
    	notebooksQuery.fields(["*"]);
    	notebooksQuery.run(function(err, featureCollection, response){
    		console.log(response);
    		console.log(featureCollection);

    		for (i in response.features){
    			notebooksManager.add(response.features[i].attributes)
    		}

    		console.log(globalNotebookContentArray)

    		indicator();
    	});

    } 

    function replaceURL(notebookNumber){

    	var thumbURL = "https://geodata.wgnhs.uwex.edu/lake-superior-legacy/assets/notebook-thumbs/fieldNotebook" + notebookNumber + "_cover_thumb.jpg";

    	var img = new Image();

    	img.onload = function(resp){
    			console.log('found')
    			$("#coverImage_" + notebookNumber).attr("src", thumbURL)

    			for (i in globalNotebookContentArray){
    				if (globalNotebookContentArray[i].Number === notebookNumber){
    					globalNotebookContentArray[i].coverURL = thumbURL;
    				}
    			}

    		}

    	img.src = thumbURL

    }

    function replaceImages(indicator){

    	for (i in globalNotebookContentArray){
    		replaceURL(globalNotebookContentArray[i].Number)
    	}

    	indicator();
    }

    function buildNotebooksList(indicator){
    	console.log("ran now")

    	$(".divisionEntry").remove();

    	for (i in globalNotebookContentArray){

    		var divisionEntry = "<div class='divisionEntry'>";
    		divisionEntry += "<img src='" + globalNotebookContentArray[i].coverURL + "' alt='Notebook Cover Photo' id='coverImage_" + globalNotebookContentArray[i].Number + "'>"
    		divisionEntry += "<div class='detailsDiv'>"
    		divisionEntry += "<p>Field Notebook #" + globalNotebookContentArray[i].Number + "</p>";
    		if (globalNotebookContentArray[i].Title){
    			divisionEntry += "<p>" + globalNotebookContentArray[i].Title + "</p>";
    		} else {
    			divisionEntry += "<p>[Untitled]</p>";
    		}
    		divisionEntry += "<p>by " + globalNotebookContentArray[i].Author + "</p>";
    		divisionEntry += "<p>" + globalNotebookContentArray[i].Year + "</p>";
    		if (globalNotebookContentArray[i].Notes){
    			divisionEntry += "<p>Notes: " + globalNotebookContentArray[i].Notes + "</p>";
    		}
    		if (globalNotebookContentArray[i].UwdcUrl){
    			divisionEntry += "<p>Scan at UW digital Collections: <a href='" + globalNotebookContentArray[i].UwdcUrl + "' target=_blank>" + globalNotebookContentArray[i].UwdcUrl + "</a></p>";
    		}
    		divisionEntry += "</div>";
    		divisionEntry += "</div>";

    		$("#notebooksContent").append($(divisionEntry))
    	}


    	indicator();
    }

    function callSort(indicator){
    	if (sortMethod == "Author"){
    		notebooksManager.sortByLetter(sortMethod,sortOrder)
    	} else {
    		notebooksManager.sortByNumber(sortMethod,sortOrder)
    	}
    	console.log(globalNotebookContentArray)
    	indicator();
    }

    var notebooksManager = (function(){

    	var add = function(array){
    		array.coverURL = "images/notebooks/notebook-icon.jpg";
    		globalNotebookContentArray = globalNotebookContentArray.concat(array);

    	};

    	var sortByNumber = function(attr, direction){

    		console.log("sort by " + attr + "in " + direction + " order")

    		if (direction == "ascending"){

	    		globalNotebookContentArray.sort(function(a,b){
	    			if(parseInt(a[attr]) < parseInt(b[attr])) return -1;
	    			if(parseInt(a[attr]) > parseInt(b[attr])) return 1;
	    			return 0;
	    		});

	    	} else if (direction == "descending") {

	    		globalNotebookContentArray.sort(function(a,b){
	    			if(parseInt(a[attr]) > parseInt(b[attr])) return -1;
	    			if(parseInt(a[attr]) < parseInt(b[attr])) return 1;
	    			return 0;
	    		});
	    		
	    	}
    	};

    	var sortByLetter = function(attr, direction){

    		console.log("sort by " + attr + "in " + direction + " order")

    		if (direction == "ascending"){

	    		globalNotebookContentArray.sort(function(a,b){
	    			if(a[attr] < b[attr]) return -1;
	    			if(a[attr] > b[attr]) return 1;
	    			return 0;
	    		});

	    	} else if (direction == "descending") {

	    		globalNotebookContentArray.sort(function(a,b){
	    			if(a[attr] > b[attr]) return -1;
	    			if(a[attr] < b[attr]) return 1;
	    			return 0;
	    		});
	    		
	    	}
    	};

    	return {"add":add,"sortByNumber":sortByNumber,"sortByLetter":sortByLetter}

    })();

    async.series([retrieveNotebooks, callSort, buildNotebooksList, replaceImages])




    </script><!-- end javascript for building the notebook list -->
   
   
</BODY> 
</HTML>