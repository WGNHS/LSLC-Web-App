<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
   <HEAD>
      <TITLE>LSLC Notebooks</TITLE> <link rel='icon' type='image/x-icon' href='favicon.ico'/>
       <meta charset="UTF-8">
       <meta name="viewport" content="width=device-width, initial-scale=1.0">
 
       <!--Google font-->
            <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600" rel="stylesheet">

       <!-- Async -->
            <script src="https://unpkg.com/async@2.4.0/dist/async.min.js"></script>
       <!-- docs  caolan.github.io/async/docs.html -->

       <!-- Load Leaflet from CDN-->
           <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
           <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet-src.js"></script>
       
       <!-- Load Esri Leaflet from CDN -->
            <script src="https://unpkg.com/esri-leaflet@2.0.7"></script>
 
       <!-- JQuery  -->
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
       
       <!-- JQuery UI  -->
            <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.0/themes/smoothness/jquery-ui.css">
            <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.0/jquery-ui.min.js"></script>
    
       
       <!-- local stylesheets -->
           <LINK href="generalStyle.css" rel='stylesheet'/>
           <LINK href="recordStyle.css" rel='stylesheet'/> 
           <LINK href="modalStyle.css" rel='stylesheet'/>

           <style>
           #menus{
           	height: 30px;
           	width: 20%;
           	background-color: #e6e6e6;
           	text-align: center;

           }
           #menus:hover{
			    cursor: pointer;
			    background-color: dimgrey;
			}

			.menuItem{
				height: 30px;
				width: 100%;
				position: relative;
				top: 20px;
				background-color: #fff;
				text-align: center;
			}

			.menuItem:hover{
				background-color: #e6e6e6;
			}
               
          #notebookFilters {
               background-color: #e6e6e6;
              max-width: 33%;
              
           }
           #notebookFilters h3 {
               width: 100%;
           }
           #notebookFilters .filter {
                overflow: hidden;
                display: block;
                vertical-align: top;
                margin: 5px 8px 0 5px;

           }
           #notebookFilters input {
               float: right;
           }


           </style>

       
      <!-- Enable media queries for old IE -->
      <!--[if lt IE 9]>
        <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
      <![endif]-->
       
       <!-- Google analytics: place in the head tag after other script links -->
       <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-50757423-2', 'auto');
          ga('send', 'pageview');

       </script>
       
</HEAD>
<BODY>
  
   <div id="header"></div>
    
   <div id="wrapper">
        

       <div id="header"></div>
       <div id="notebookFilters">
           <h3 class="orangeBar">Filter notebooks</h3>
           <div class="filter">
               <label for="AuthorSearch"><span>Author</span></label>
               <input type="text" id="AuthorSearch" name="AuthorSearch">
           </div>
           <div class="filter">
               <label for="TitleSearch"><span>Title</span></label>
               <input type="text" id="TitleSearch" name="TitleSearch">
           </div>
           <div class="filter">
               <label for="YearSearch"><span>Year</span></label>
               <input type="text" id="YearSearch" name="YearSearch">
           </div>
           <div class="filter">
               <label for="NumberSearch"><span>Notebook number</span></label>
               <input type="text" id="NumberSearch" name="NumberSearch">
           </div>
           <div id="menus">Sort By</div>
       </div>

       <div class="reportDivision">
           <span>This is a list of all field notebooks in the Lake Superior Legacy Collection. Most of these notebooks are available as digital scans on the UW Digital Collections website. Some were not prioritized for scanning, and some no longer exist.</span>
       	<h3>Notebooks</h3> 
       
       
       <!-- <div class='reportDivision'><div id="fieldNotebooksList"></div></div> -->
       <div class='divisioncontent' id='notebooksContent'></div>
   
       </div>
       <div id="footer"></div>
   </div><!--end wrapper div-->
   
   <!-- header js and css to highlight the corresponding nav button: must go after the wrapper div and header div -->
   <script src="header.js"></script>
   <script>
           //indicate the current page in the nav bar. 
          // $("#navHome").css("background-color", "#848484");
   </script>
    
    <!-- javascript links -->
    <script src="mapServiceUrls.js"></script>
    
    <!-- javascript for building the notebook list -->
    <script>
    //globals
    var globalNotebookContentArray = [];
    var menuOn = false;
    var sortMethod = "Number";
    var sortOrder = "ascending";
    var authorSearchOn = false;
    var titleSearchOn = false;
    var numberSearchOn = false;
    var yearSearchOn = false;
    var x;

    var delay = (function(){
      var timer = 0;
      return function(callback, ms){
        clearTimeout (timer);
        timer = setTimeout(callback, ms);
      };
    })();


    $("#menus").click(function(){
    	if (!menuOn){
    		menuOn = true;
    		$(this).append($("<div id='menu_year' class='menuItem'>Year</div><div id='menu_number' class='menuItem'>Notebook Number</div><div id='menu_author' class='menuItem'>Author</div><div id='menu_title' class='menuItem'>Title</div>"));

	    		$("#menu_year").click(function(){
			    	sortMethod = "Year";
			    	async.series([callSort, buildNotebooksList, replaceImages]);
			    })

			    $("#menu_number").click(function(){
			    	sortMethod = "Number";
			    	async.series([callSort, buildNotebooksList, replaceImages]);
			    })

			    $("#menu_author").click(function(){
			    	sortMethod = "Author";
			    	async.series([callSort, buildNotebooksList, replaceImages]);
			    })

			    $("#menu_title").click(function(){
			    	sortMethod = "Title";
			    	async.series([callSort, buildNotebooksList, replaceImages]);
			    })

    	} else {
    		menuOn = false;
    		$(".menuItem").remove();
    	};
    });

    $("#AuthorSearch").on('input', function(){
    	authorSearchOn = true;
    	delay(function(){
    		async.series([callfilter, buildNotebooksList, replaceImages]);
    	}, 1000);
    })
	$("#NumberSearch").on('input', function(e){
		numberSearchOn = true;
    	window.setTimeout(function(){
    		async.series([callfilter, buildNotebooksList, replaceImages]);
    	}, 1000);
    })
    $("#YearSearch").on('input', function(e){
    	yearSearchOn = true;
    	window.setTimeout(function(){
    		async.series([callfilter, buildNotebooksList, replaceImages]);
    	}, 1000);
    })
    $("#TitleSearch").on('input', function(e){
    	titleSearchOn = true;
    	window.setTimeout(function(){
    		async.series([callfilter, buildNotebooksList, replaceImages]);
    	}, 1000);
    })
 
        
    function retrieveNotebooks(indicator){
    	var notebooksQuery = L.esri.query({url: notebooksTableURL});
    	notebooksQuery.fields(["*"]);
    	notebooksQuery.run(function(err, featureCollection, response){

    		for (i in response.features){
    			notebooksManager.add(response.features[i].attributes)
    		}

    		indicator();
    	});

    } 

    function replaceURL(notebookNumber){

    	var thumbURL = "https://geodata.wgnhs.uwex.edu/lake-superior-legacy/assets/notebook-thumbs/fieldNotebook" + notebookNumber + "_cover_thumb.jpg";

    	var img = new Image();

    	img.onload = function(resp){
    			$("#coverImage_" + notebookNumber).attr("src", thumbURL)

    			for (i in globalNotebookContentArray){
    				if (globalNotebookContentArray[i].Number === notebookNumber){
    					globalNotebookContentArray[i].coverURL = thumbURL;
    				}
    			}

    		}

    	img.src = thumbURL

    }

    function replaceImages(indicator){

    	for (i in globalNotebookContentArray){
    		replaceURL(globalNotebookContentArray[i].Number)
    	}

    	indicator();
    }

    function buildNotebooksList(indicator){

    	$(".divisionEntry").remove();

    	console.log(globalNotebookContentArray)

    	for (i in globalNotebookContentArray){

    		if (globalNotebookContentArray[i].show){

	    		var divisionEntry = "<div class='divisionEntry'>";
	    		divisionEntry += "<img src='" + globalNotebookContentArray[i].coverURL + "' alt='Notebook Cover Photo' id='coverImage_" + globalNotebookContentArray[i].Number + "'>"
	    		divisionEntry += "<div class='detailsDiv'>"
	    		divisionEntry += "<p>Field Notebook #" + globalNotebookContentArray[i].Number + "</p>";
	    		if (globalNotebookContentArray[i].Title){
	    			divisionEntry += "<p>" + globalNotebookContentArray[i].Title + "</p>";
	    		} else {
	    			divisionEntry += "<p>[Untitled]</p>";
	    		}
	    		divisionEntry += "<p>by " + globalNotebookContentArray[i].Author + "</p>";
	    		divisionEntry += "<p>" + globalNotebookContentArray[i].Year + "</p>";
	    		if (globalNotebookContentArray[i].Notes){
	    			divisionEntry += "<p>Notes: " + globalNotebookContentArray[i].Notes + "</p>";
	    		}
	    		if (globalNotebookContentArray[i].UwdcUrl){
	    			divisionEntry += "<p>Scan at UW digital Collections: <a href='" + globalNotebookContentArray[i].UwdcUrl + "' target=_blank>" + globalNotebookContentArray[i].UwdcUrl + "</a></p>";
	    		}
	    		divisionEntry += "</div>";
	    		divisionEntry += "</div>";

	    		$("#notebooksContent").append($(divisionEntry))
	    	};
    	};


    	indicator();
    }

    function callSort(indicator){
    	if (sortMethod == "Author" || sortMethod == "Title"){
    		notebooksManager.sortByLetter(sortMethod,sortOrder)
    	} else {
    		notebooksManager.sortByNumber(sortMethod,sortOrder)
    	}

    	indicator();
    }

    function callfilter(indicator){
    	var searchText = {};
    	searchText.authorKey = document.getElementById("AuthorSearch").value;
    	searchText.titleKey = document.getElementById("TitleSearch").value;
    	searchText.numberKey = document.getElementById("NumberSearch").value;
    	searchText.yearKey = document.getElementById("YearSearch").value;
    	notebooksManager.filterBySearch(searchText)
    	indicator();
    }

    var notebooksManager = (function(){

    	var add = function(object){
    		object.coverURL = "images/notebooks/notebook-icon.jpg";
    		object.show = true
    		globalNotebookContentArray = globalNotebookContentArray.concat(object);

    	};

    	var sortByNumber = function(attr, direction){

    		console.log("sort by " + attr + " in " + direction + " order")

    		if (direction == "ascending"){

	    		globalNotebookContentArray.sort(function(a,b){
	    			if(parseInt(a[attr]) < parseInt(b[attr])) return -1;
	    			if(parseInt(a[attr]) > parseInt(b[attr])) return 1;
	    			return 0;
	    		});

	    	} else if (direction == "descending") {

	    		globalNotebookContentArray.sort(function(a,b){
	    			if(parseInt(a[attr]) > parseInt(b[attr])) return -1;
	    			if(parseInt(a[attr]) < parseInt(b[attr])) return 1;
	    			return 0;
	    		});
	    		
	    	}
    	};

    	var sortByLetter = function(attr, direction){

    		console.log("sort by " + attr + "in " + direction + " order")

    		if (direction == "ascending"){

	    		globalNotebookContentArray.sort(function(a,b){
	    			if(a[attr] < b[attr]) return -1;
	    			if(a[attr] > b[attr]) return 1;
	    			return 0;
	    		});

	    	} else if (direction == "descending") {

	    		globalNotebookContentArray.sort(function(a,b){
	    			if(a[attr] > b[attr]) return -1;
	    			if(a[attr] < b[attr]) return 1;
	    			return 0;
	    		});
	    		
	    	}
    	};

    	var filterBySearch = function(searchTextObject){

    		for (i in globalNotebookContentArray){

    			var showTheNotebook = true;

    			if (!globalNotebookContentArray[i]["Author"].includes(searchTextObject.authorKey) && authorSearchOn){
    				showTheNotebook = false;
    			};

      		if (globalNotebookContentArray[i]["Title"]){
            if (!globalNotebookContentArray[i]["Title"].includes(searchTextObject.titleKey) && titleSearchOn) {
      				showTheNotebook = false;
      			};
          } else {
              showTheNotebook = false;
          }

    			if (!globalNotebookContentArray[i]["Number"].includes(searchTextObject.numberKey) && numberSearchOn) {
    				showTheNotebook = false;
    			};

    			if (!globalNotebookContentArray[i]["Year"].includes(searchTextObject.yearKey) && yearSearchOn){
    				showTheNotebook = false;
    			};

    			globalNotebookContentArray[i].show = showTheNotebook;
    		}; 

    	};

    	return {"add":add,
    		"sortByNumber":sortByNumber,
    		"sortByLetter":sortByLetter,
    		"filterBySearch":filterBySearch
    	}

    })();

    async.series([retrieveNotebooks, callSort, buildNotebooksList, replaceImages])




    </script><!-- end javascript for building the notebook list -->
   
   
</BODY> 
</HTML>