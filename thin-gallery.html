<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
   <HEAD>
      <TITLE>LSLC Thin Sections</TITLE> <link rel='icon' type='image/x-icon' href='favicon.ico'/>
       <meta charset="UTF-8">

 
        <!--Google font-->
            <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600" rel="stylesheet">
       
        <!-- Async from CDN -->    
            <script src="https://unpkg.com/async@2.4.0/dist/async.min.js"></script>
        <!-- docs: http://caolan.github.io/async/docs.html -->
       
       <!-- Load Leaflet from CDN-->
           <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
           <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet-src.js"></script>
       
       <!-- Load Esri Leaflet from CDN -->
            <script src="https://unpkg.com/esri-leaflet@2.0.7"></script>
 
       <!-- JQuery  -->
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
       
       <!-- JQuery UI  -->
            <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.0/themes/smoothness/jquery-ui.css">
            <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.0/jquery-ui.min.js"></script>
    
       
       <!-- local stylesheets -->
           <LINK href="generalStyle.css" rel='stylesheet'/>
           <LINK href="recordStyle.css" rel='stylesheet'/> 
           <LINK href="modalStyle.css" rel='stylesheet'/>

       
      <!-- Enable media queries for old IE -->
      <!--[if lt IE 9]>
        <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
      <![endif]-->
       
</HEAD>
<BODY>
  
   <div id="header"></div>
   <div id="wrapper">
        

       <h2>Thin Sections Gallery</h2> 
       <span>Mouse-over to view cross-polarized images</span>
       
     <!--  <div class='reportDivision'><div id="fieldNotebooksList"></div></div> -->
       <div id="thinGallery" class="divisionContent"></div>
   
       
       <div id="footer"></div>
   </div><!--end wrapper div-->
   
   <!-- header js and css to highlight the corresponding nav button: must go after the wrapper div and header div -->
   <script src="header.js"></script>
   <script>
           //indicate the current page in the nav bar. 
          // $("#navHome").css("background-color", "#848484");
   </script>
    
    <!-- javascript links -->
    <script src="mapServiceUrls.js"></script>
    
    <!-- javascript for building the thin section gallery -->
    <script>

        //global variables: 
        var globalThinSectionsArray = []; 
        
    
       function retrieveThinSectionImages(callback){
           var thinImagesQuery = L.esri.query({url: thinSectionsTableURL});
           thinImagesQuery.fields(["*"]); 
           
           thinImagesQuery.run(function(err, featureCollection, response){
//               console.log('response', response);
//               console.log('feature coll', featureCollection);
                         
               console.log("Query returned. global array: ", globalThinSectionsArray);
               
               for (i in response.features){
                   
                  thinSectionsManager.add(response.features[i].attributes);
                   
                   
               }
               callback();
               
           });

       }
        
        function consoleAfter(callback) {
            console.log("after query? ");
            callback();
        }

        
        var thinSectionsManager = (function(){
            
            var add = function(array){
                array.PPLthumbURL = 'images/notebooks/notebook-icon.jpg'; 
                globalThinSectionsArray = globalThinSectionsArray.concat(array);
                
            }
            
            
            var sort = function(attr, direction){
                               
                console.log("sort by "+attr+" in "+direction+" order."); 
                
                globalThinSectionsArray.sort(function (a,b){
                  
                    if(Number(a[attr]) < Number(b[attr])) return -1; 
                    if(Number(a[attr]) > Number(b[attr])) return 1; 
                    return 0;
                                                         
                });
                
                console.log(globalThinSectionsArray);
            }
            
            return {
                "add": add, 
                "sort": sort,
            }
            
        })();   
        
         
        
        function replaceThumbnailImage(number){
            var PPLthumbURL = 'https://geodata.wgnhs.uwex.edu/lake-superior-legacy/assets/thin-section-thumbs/'+number+'ppl_thumb.jpg';
            
            var testImage = new Image(); 
            
            
            testImage.onload = function(){
                //successfully found the new image.  
                console.log("image found");
                //replace the image in the html page. 
                console.log("element", $("#pplthumb_"+number));
                
                
               $("#pplthumb_"+number).attr('src', testImage.src);
                
                
                //replace the data attribute in the global data array
                for(i in globalThinSectionsArray){
                    if (globalThinSectionsArray[i].CatalogNumber === number){
                        globalThinSectionsArray[i].PPLthumbURL = testImage.src;
                    }
                }
                console.log("global array: ", globalThinSectionsArray);
                
                
            }
            
            testImage.src= PPLthumbURL; 
            
        }
        
        function replaceDataAttribute(){
            
        }
        
        function replaceImages(){
            
            var subset = [{"CatalogNumber": "1"}, {"CatalogNumber": "11"}, {"CatalogNumber": "12"}, {"CatalogNumber": "13"}];
            
            for (i in subset){
               // thinNumber = globalThinSectionsArray[i].CatalogNumber;
                thinNumber = subset[i].CatalogNumber;
                replaceThumbnailImage(thinNumber);
               
            }
                
            
        }
        
        function buildThinGallery(callback) {
            var divisionContent= '';
            
            //for every thin section...
            for (i in globalThinSectionsArray.slice(0,10)){
               // console.log("item", globalThinSectionsArray[i]);
                
                var thinDiv = '<div>';
                
                thinDiv += "<img src='images/notebooks/notebook-icon.jpg' id='pplthumb_"+globalThinSectionsArray[i].CatalogNumber+"'/>";
                
                thinDiv += globalThinSectionsArray[i].CatalogNumber;
                
                thinDiv += "</div>";
                
                divisionContent += thinDiv;
                
                
            }
            
            
            $("#thinGallery").append(divisionContent);
            
            callback();
        }
        
        function sort(callback){
            thinSectionsManager.sort("CatalogNumber", "ascending"); 
            callback();
        }
        
        async.series([retrieveThinSectionImages, sort, buildThinGallery, replaceImages, consoleAfter], function(){
            console.log("all done. global data array: ", globalThinSectionsArray);
        });
        
        
    </script><!-- end javascript for building the notebook list -->
   
   
</BODY> 
</HTML>