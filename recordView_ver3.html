<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
   <HEAD>
      <TITLE>Sample Record version 3</TITLE>
       <meta charset="UTF-8">
       
        <LINK href="generalStyle.css" rel='stylesheet'/>
       
       <!--Google font-->
       <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600" rel="stylesheet">
       
       

       <!-- Leaflet -->
            <!-- online -->
            <script src="https://npmcdn.com/leaflet@1.0.0-rc.3/dist/leaflet.js"></script>
           <!-- local -->  
            <script src="lib/leaflet.js"></script>

            <link rel="stylesheet" href="lib/leaflet.css" />
       <!-- Zoomify Leaflet -->
            <script type="text/javascript" src="lib/zoomify_layer.js"></script>
            <!--<script type="text/javascript" src="script/zoomify_layer.js"></script>-->
       
       <!-- JQuery  -->
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
       
       <!-- JQuery UI  -->
            <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.0/themes/smoothness/jquery-ui.css">
            <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.0/jquery-ui.min.js"></script>
       
       
       <LINK href="recordStyle.css" rel='stylesheet'/> 
       <LINK href="modalStyle.css" rel='stylesheet'/>
       
      <!-- Enable media queries for old IE -->
      <!--[if lt IE 9]>
        <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
      <![endif]-->
       
   </HEAD>
   <BODY>
       <div id="modalBackground" class="modalBackground">
           <div id="modal-content"></div>
       </div>       
  
    <div id="wrapper">
      <h3>Sample Record</h3>
            
        
            <div id="sampleRecord"></div>
 
      <!-- add a project footer... -->
        <div id='footer'>
           <p> Lake Superior Legacy Collection <br/>
            Wisconsin Geological and Natural History Survey <br/>
            University of Wisconsin Extention 
           </p>
        </div>

   
    </div><!--end wrapper div-->    
       
    <script type="text/javascript">
       
        var samID = 2759;

        //The parts of the report webpage are referred to as 'divisions' in this code. 
        //The buildReport function will iterate through this array.
        //this creates the skeleton of the webpage.
        var reportDivisions = [
            {"divisionTitle":"Thin Sections", "divisionId":"thinSections", "attributes": [
                    {   "attrSource":"ThinSectionCount",
                        "attrLabel":"Number of Thin Sections: ",
                        "attrVar":"thinSectionCount"
                    }
                /*    , 
                    {
                        "attrSource":"", 
                        "attrLabel":"",
                        "attrTag":"img",
                        "attrVar": "thinImgppl"
                    }, 
                    {
                        "attrSource":"", 
                        "attrLabel":"", 
                        "attrTag":"img",
                        "attrVar": "thinImgxpl"
                    }
                */
            ]}, 
            {"divisionTitle":"Location", "divisionId":"location", "attributes": [
                    {
                        "attrSource":"SectionId",
                        "attrLabel":"PLSS Section", 
                        "attrVar": "mapSectionId"
                    }, 
                    {
                        "attrSource":"Township",
                        "attrLabel":"Township", 
                        "attrVar": "township"

                    },
                    {
                        "attrSource":"Range",
                        "attrLabel":"Range", 
                        "attrVar": "range"

                    },
                    {
                        "attrSource":"Direction",
                        "attrLabel":"", 
                        "attrVar": "rangeDirection"

                    },
                    {
                        "attrSource":"Section_",
                        "attrLabel":"Section", 
                        "attrVar": "PLSSsection"

                    },
                    {
                        "attrSource":"Quarter",
                        "attrLabel":"Quarter-section", 
                        "attrVar": "quarterSection"

                    },
                    {
                        "attrSource":"QuarterQuarter",
                        "attrLabel":"Quarter-quarter-section", 
                        "attrVar": "quarterQuarterSection"

                    },
                    {
                        "attrSource":"State", 
                        "attrLabel":"State:", 
                        "attrVar": "state"
                    },
                    {
                        "attrSource":"County", 
                        "attrLabel":"County:", 
                        "attrVar": "county"
                    }, 
                    {
                        "attrSource":"LocNote", 
                        "attrLabel":"Location Notes:", 
                        "attrVar": "locationNote"
                    }
            ]}, 
            {"divisionTitle":"Field Notes", "divisionId":"fieldNotes", "attributes":[
                    {
                        "attrSource":"", 
                        "attrLabel":"", 
                        "attrVar":"fieldNotebookThumb"
                    },    
                    {
                        "attrSource":"NotebookPage", 
                        "attrLabel":"Page", 
                        "attrVar":"fieldPage"
                    }, 
                    {
                        "attrSource":"NotebookId", 
                        "attrLabel":"Notebook", 
                        "attrVar":"fieldNotebookId"
                    }, 
                    {
                        "attrSource":"NotebookTitle", 
                        "attrLabel":"", 
                        "attrVar":"fieldNotebookTitle"
                    },
                    {
                        "attrSource":"", 
                        "attrLabel":"by", 
                        "attrVar":"fieldAuthor"
                    }, 
                    {
                        "attrSource":"", 
                        "attrLabel":"", 
                        "attrVar":"fieldDate"
                    }, 
                    {
                        "attrSource":"", 
                        "attrLabel":"", 
                        "attrVar":"fieldNotebookUrl"
                    }
                
                
            ]}, 
            {"divisionTitle":"Lithological Descriptions","divisionId":"lithDesc", "attributes":[
                    {
                        "attrSource":"", 
                        "attrLabel":"Page", 
                        "attrTag": "p",
                        "attrVar":"lithPage"
                    }, 
                    {
                        "attrSource":"", 
                        "attrLabel":"", 
                        "attrVar":"lithNotebookId"
                    },
                    {
                        "attrSource":"", 
                        "attrLabel":"", 
                        "attrVar":"lithNotebookUrl"
                    },
                    {
                        "attrSource":"", 
                        "attrLabel":"", 
                        "attrVar":"lithNotebookThumb"
                    },
                    {
                        "attrSource":"", 
                        "attrLabel":"", 
                        "attrVar":"lithAuthor"
                    }, 
                    {
                        "attrSource":"", 
                        "attrLabel":"", 
                        "attrVar":"lithDate"
                    }, 
                    {
                        "attrSource":"", 
                        "attrLabel":"", 
                        "attrVar":"lithNotebookTitle"
                    }
                
                
            ]}, 
            {"divisionTitle":"Sample Notes","divisionId":"sampleNotes", "attributes":[
                
                {
                        "attrSource":"Notes", 
                        "attrLabel":"",
                        "attrVar":"sampleNotes"
                    }
                
                
            ]},
            {"divisionTitle":"Available Samples","divisionId":"availableSamples", "attributes":[
                    {
                        "attrSource":"WgnhsId", 
                        "attrLabel":"WGNHS ID", 
                        "attrVar":"WGNHSId"
                    }
                
                
            ]}  
        ]; 
        
        //this object will hold all of the data for the record.
        //this data must be drawn from several different tables. 
        var sampleRecordData = {
            "sampleId":00,
            "rockType":"undefined",
            "thinSectionCount":1, 
            "thinSections": [{"thinSectionId":2759, "thinImgppl": "", "thinImgxpl": "", "thinThumbppl":"images\400pxwide\2793ppl_400pxwide.jpg", "thinThumbxpl": "images\400pxwide\2793xpl_400pxwide.jpg"}], 
            
            "mapSectionId": 2959,
            "state": "Wisconsin",
            "township":"45N",
            "range":"01W",
            "PLSSsection": "11",
            "quarterSection": "SE",
            "quarterQuarterSection": "NE",
            "locationNote": "Penokee Range", 
            
            "fieldNotebookId":0,
            "fieldPage": 44,
            "fieldNotebookTitle": "Penokee Iron Region, Wisconsin",
            "fieldNotebookThumb":"images/notebooks/fieldNotebook31_thumb.jpg",
            "fieldNotebookUrl":"http://digicoll.library.wisc.edu/cgi-bin/EcoNatRes/EcoNatRes-idx?type=article&did=EcoNatRes.VHBook035.i0001&id=EcoNatRes.VHBook035&isize=M", 
            "fieldAuthor":"C.R. Van Hise",
            "fieldDate": "1885",
            
            
            "lithNotebookId": "V",
            "lithPage": 117,
            "lithNotebookTitle":"U.S. Geological Survey: lithological descriptions: The Huronian mica schists and black slates",
            "lithDate":"1886-1888", 
            "lithAuthor":"C.R. Van Hise",
            "lithNotebookUrl": "http://digicoll.library.wisc.edu/cgi-bin/EcoNatRes/EcoNatRes-idx?type=header&id=EcoNatRes.LithDescV&isize=M",
            "lithNotebookThumb":"images/notebooks/lithBookV_thumb.jpg",
            "WGNHSId":"26700030",
            "sampleNotes":""
            
        }; 
        
        //will need to retrieve data from five tables and place it into an internal data object.
        $.getJSON('data/esriResult_sample2759.json', function(data){
            console.log("data:", data);
            
        // from the SAMPLES TABLE...    
        //based on the samID variable, find the object within the features array that matches that sample ID...
            var selectedSample = jQuery.grep(data.features, function(object, index){
                console.log("object.attributes.SampleId:", object.attributes.SampleId);
                var thisSampleId = object.attributes.SampleId;
                console.log("thisSampleId", thisSampleId);
                return(thisSampleId === samID);
            });
            var sample = selectedSample[0].attributes;
            console.log("selectedSample[0]:", sample);
            
            //re-assign the sampleRecordData values as the actual data values. 
            sampleRecordData.sampleId = sample.SampleId;
            sampleRecordData.rockType = sample.RockType;
            sampleRecordData.fieldNotebookId = sample.NotebookId;
            
            //build the sections and divs to contain report information...
            buildReport(sample);
           
         
            //populate sections of the report with information...
        //    addThinSections(selectedSample[0].attributes);
       //     addFieldNotes(selectedSample[0].attributes);
          //  addLithDesc(selectedLithDesc[0]);
        //    addLocation(selectedSample[0].attributes);
         //   addNotes(selectedSample[0].attributes);
        //    addCollection(selectedSample[0].attributes);
        })
            //for debugging json load errors
           // .done(function(){console.log('success', arguments);})
           // .fail(function(){console.log('failure', arguments);})
        
        ; //end getJSON
       
               
        function buildReport(sample){
            console.log("build report for sample ",sample); 
            
            var sampleIDh2 = $('<h2></h2>').html("Sample #"+sampleRecordData.sampleId); 
            
            var rockTypep = $('<p></p>').text(sampleRecordData.rockType);
            rockTypep.css("font-size","14pt");
            
            $('#sampleRecord').append(sampleIDh2, rockTypep);
            
            //iterate through the reportDivisions array above, 
            //creating a div for each with an id property and h3 title 
            
            for (r in reportDivisions){
                //create a new div element.
                var newdiv = $('<div></div>');
                var rd = reportDivisions[r];
                //give it an id property and add a title h3 to it. 
                newdiv.attr("id", rd.divisionId);
                newdiv.append($('<h3></h3>').html(rd.divisionTitle));
                //append it to the html page. 
                $('#sampleRecord').append(newdiv);
                
  /*              if (rd.divisionId !== "thinSections"){
    //                populateReportDivision(newdiv, rd.attributes, sample);
                    // console.log(rd.attributes);
                } else {
                    console.log("add thin sections.");
                    addThinSections(sample);
                }
    */           
                
            }
            
            //populate the various fields in the report, using the values in the sampleRecordData object (global variable)
            addFieldNotes();
            
        } //end buildReport 
        
        function populateReportDivision(newdiv, attributes, sample){
        //   receives an array of objects. Each object pertains to one variable. 
            console.log("new div:", newdiv);
            for (i=0; i<attributes.length; i++){
                //for each attribute...
        //console.log("attributes[i] is",attributes[i]);
                var attr = attributes[i];
                var entry = '';
                entry +=   "<p>"+attr.attrLabel+" "+sample[attr.attrSource]+"</p>";
                $(newdiv).append(entry);
            }
            
            
        }
        
       function addThinSections(sample){
            console.log("sample",sample);
            //populate the thin section results:
       /*     if (sample.thinSections.length>0){
                for (i in sample.thinSections){
                    
                    console.log("thin section", sample.thinSections[i]);
                    
                    //a container at block-level
                    var thinSectionContainer = $('<div></div>');
                    thinSectionContainer.addClass('thinSectionContainer');
                    
                    var thinSec = $('<div></div>').html("<p>Thin section #"+sample.thinSections[i]+"</p><img src='images/400pxwide/"+sample.thinSections[i]+"ppl_400.jpg' alt='plane-polar image'/><img src='images/400pxwide/"+sample.thinSections[i]+"xpl_400.jpg' alt='cross-polar image'/>");
                    thinSec.addClass('thinSection');
                    thinSec.attr('title','click to view');
                    thinSec.data({'thinID':sample.thinSections[i]});
                    
                    //add the thin section area into its block-level container
                    thinSectionContainer.append(thinSec);
                    //add the block-level container into the overall div of all thin sections. this is later appended to the record. 
                    $('#thinSections').append(thinSectionContainer);
                    
                } } else {
                console.log("none");
                $('#thinSections').append('<p>none.</p>');
                //$("#sampleRecord").append("<p>none</p>");
            }
            
             $(".thinSection").on('click', function(){
                console.log("view thin section #", $(this).data('thinID'));
                
                modal.thinSectionViewer($(this).data('thinID'));
            })
       */     
            
        } //end addThinSections function
        
         function addFieldNotes(){
            var fieldNotebookreport = ''; 
            if (sampleRecordData.fieldNotebookId > 0){
                fieldNotebookreport += "<a href='"+sampleRecordData.fieldNotebookUrl+"' target=_blank> <img src='"+sampleRecordData.fieldNotebookThumb+"' alt='notebook cover'/></a>";
                fieldNotebookreport+="<div class='detailsDiv'><p>Page "+sampleRecordData.fieldPage+"</p> <a href='"+sampleRecordData.fieldNotebookUrl+"' target=_blank>"+sampleRecordData.fieldNotebookTitle+"</a><p>"+sampleRecordData.fieldAuthor+"</p><p>"+sampleRecordData.fieldDate+"</p></div>";
     
            } else {
                fieldNotebookreport+="<p>none</p>";
            }
            
            //append to the appropriate div
            $('#fieldNotes').append(fieldNotebookreport);
        }
        
 /*       function addLithDesc(lithDesc){
            var lith = '';
            if(lithDesc){
                lith+="<a href='http://digicoll.library.wisc.edu/cgi-bin/EcoNatRes/EcoNatRes-idx?type=article&did=EcoNatRes.LithDescIV.i0001&id=EcoNatRes.LithDescIV&isize=M' target=_blank><img style='height: 200px;' src='images/notebooks/lithologicalDesc1.jpg' alt='lithological descriptions book cover' /></a>"
                lith+="<div class='detailsDiv'><p>"+lithDesc.rockType+"</p><a href='http://digicoll.library.wisc.edu/cgi-bin/EcoNatRes/EcoNatRes-idx?type=article&did=EcoNatRes.LithDescIV.i0001&id=EcoNatRes.LithDescIV&isize=M' target=_blank>United States Geological Survey: lithological descriptions Book IV (1884-1885)</a><p>Charles Van Hise</p><p>1884</p></div>"
            } else {
                lith+="<p>none</p>";
            }
            
            //append to the appropriate div
            $('#lithologicalDesc').append(lith);
            
        }
        
        function addLocation(sample){
            
            var loc = ''
            loc+="<img src='images/mapMockup.jpg' alt='sample of map'/>";
            loc+="<div class='detailsDiv'>";
            for (prop in sample.location){
                //console.log("prop:", prop);
                loc+="<p><span class='green'>"+prop+":</span> "+sample.location[prop]+"</p>";
            }
            loc+="</div>"; //end details div
            $('#location').append(loc);
        }
        
        function addNotes(sample){
            if (sample.notes){
                $('#sampleNotes').append('<p>'+sample.notes+'</p>');
            } else {
                $('#sampleNotes').append('<p>none</p>');
            }
        }
        
        function addCollection(){
            
            $('#collections').append('<p>Information about where to find the physical samples, if available...</p>');
        }
  */      
   </script>   
        <script src="modal.js"></script>
   </BODY>
</HTML>